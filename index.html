<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Science Safety Adventure</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Fredoka+One&family=Inter:wght@400;600&display=swap");

      :root {
        --primary: #5170ff;
        --primary-dark: #3a5bd9;
        --accent: #ff6600;
        --danger: #c62828;
        --success: #2e7d32;
        --warning: #ff9900;
        --card-bg: #ffffbc;
        --text: #222;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: url("Screenshot 2025-08-22 183411.png") no-repeat center
          center fixed;
        background-size: cover;
        color: var(--text);
        text-align: center;
        margin: 0;
        padding: 10px;
        font-weight: bolder;
        font-size: 16px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      #loadingScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(145deg, #7cce6b, #d8ffd0);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 9999;
        animation: popIn 0.8s ease;
        transition: opacity 0.6s ease; /* fade out */
      }

      @keyframes popIn {
        0% {
          opacity: 0;
          transform: scale(0.7);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      #loadingRocket {
        width: 15vw;
        max-width: 100px;
        min-width: 60px;
        animation: spin 2s linear infinite;
        margin-bottom: 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        font-size: clamp(1.5rem, 6vw, 2.5rem);
        font-weight: bold;
        color: blue;
        animation: bounce 1s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }

      h1 {
        color: blue;
        font-family: "Fredoka One", cursive;
        font-size: 50px;
        letter-spacing: 1.5px;
        margin: 10px 0 20px 0;
        text-shadow: 2px 2px 0 #fff;
        padding: 20px;
      }

      h2 {
        color: blue;
        font-family: "Fredoka One", cursive;
        font-size: 40px;
        letter-spacing: 1px;
        margin-top: 10px;
        text-shadow: 1px 1px 0 #fff;
        padding: 1px;
      }

      .screen {
        display: none;
        width: 100%;
      }

      .active {
        display: block;
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      button {
        font-size: 20px;
        margin: 8px;
        padding: 16px 20px;
        border: none;
        border-radius: 12px;
        background-color: var(--primary);
        color: #fff;
        cursor: pointer;
        transition: transform 0.2s ease, background-color 0.2s;
        width: 90%;
        max-width: 300px;
        font-weight: bold;
        min-height: 50px;
        letter-spacing: 1px;
      }

      button:hover,
      button:focus {
        transform: scale(1.05);
        background-color: var(--primary-dark);
        outline: none;
      }

      button:active {
        transform: scale(0.98);
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        transform: none;
      }

      input,
      select {
        font-size: 1rem;
        padding: 12px;
        margin: 8px auto;
        border: 2px solid var(--accent);
        border-radius: 10px;
        background-color: #fff;
        color: var(--text);
        display: block;
        width: 90%;
        max-width: 300px;
      }

      .card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 20px 20px 25px; /* extra padding to avoid overlap with close button */
        margin: 20px auto;
        max-width: 90%;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        border: 2px solid var(--accent);
        min-height: auto;
        height: auto;
        position: relative;
        overflow: hidden; /* ensures close button doesn’t float outside rounded edges */
      }

      .close-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        background: #ff4d4d;
        border: none;
        color: #fff;
        font-size: 1.4rem; /* slightly smaller, cleaner cross */
        font-weight: normal; /* makes ❌ thinner */
        border-radius: 50%;
        width: 48px;
        height: 48px;
        cursor: pointer;
        display: flex; /* perfect centering */
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
        transition: background 0.25s ease, transform 0.2s ease;
        z-index: 10;
      }

      .close-btn:hover {
        background: #e60000;
        transform: scale(1.08);
      }

      @media (min-height: 800px) and (min-width: 768px) {
        .card {
          max-width: 600px;
          padding: 20px;
        }
      }

      #tableOutput {
        background-color: #fffbe9;
        border-radius: 15px;
        padding: 15px;
        margin-top: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .scientist-container {
        width: 100%;
        max-width: 220px;
        height: 450px;
        margin: 0 auto;
        position: relative;
      }

      .scientist-box-text {
        top: 1px;
        left: 10px;
        right: 10px;
        bottom: 1px;
        padding: 5px;
        overflow-y: auto;
        text-align: center;
        font-weight: bolder;
        font-size: 8px;
        color: #ff7300;
        padding-top: 1px;
      }

      .safety-table {
        width: 100%;
        font-size: 18px;
        font-weight: bolder;
        border-collapse: collapse;
      }

      .safety-table td {
        padding: 8px 4px;
        text-align: left;
      }

      .safety-table tr:nth-child(even) {
        background-color: #f7f7c5;
      }

      .menu-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 8px;
        max-width: 800px;
        margin: 0 auto;
        width: 100%;
        padding: 0 5px;
      }

      @media (min-width: 768px) {
        .menu-container {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 10px;
        }
      }

      .feedback {
        font-size: 16px;
        margin: 15px 0;
        padding: 10px;
        border-radius: 10px;
        font-weight: bold;
      }

      .correct {
        background-color: #a5d6a7;
        color: var(--success);
      }

      .incorrect {
        background-color: #ffab91;
        color: var(--danger);
      }

      .scenario-image {
        width: 100%;
        max-width: 300px;
        height: 200px;
        margin: 15px auto;
        border-radius: 10px;
        background-color: #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: #666;
        border: 3px solid var(--accent);
      }

      .equipment-item {
        display: flex;
        align-items: center;
        margin: 10px 0;
        padding: 12px;
        background-color: #fff;
        border-radius: 10px;
        border: 2px solid var(--accent);
        cursor: pointer;
        transition: transform 0.2s;
      }

      .equipment-item:hover,
      .equipment-item:focus {
        transform: scale(1.02);
        outline: none;
      }

      .equipment-icon {
        font-size: 24px;
        margin-right: 15px;
        width: 40px;
        text-align: center;
      }

      /* Chemical Mixing Game Styles - Enhanced */
      .chemical-game {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .chemicals-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        max-width: 600px;
        width: 100%;
      }

      @media (min-width: 480px) {
        .chemicals-container {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      @media (min-width: 768px) {
        .chemicals-container {
          grid-template-columns: repeat(4, 1fr);
          gap: 15px;
        }
      }

      .chemical-item {
        width: 100%;
        aspect-ratio: 1;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
        border: 3px solid #333;
        font-size: 18px;
        text-align: center;
        padding: 5px;
        box-sizing: border-box;
      }

      .chemical-item:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
      }

      .chemical-item.selected {
        border: 3px solid var(--accent);
        box-shadow: 0 0 10px var(--accent);
      }

      .mixing-area {
        width: 100%;
        max-width: 250px;
        min-height: 100px;
        border: 3px dashed var(--accent);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        margin: 15px 0;
        background-color: #f9f9f9;
        padding: 10px;
        text-align: center;
      }

      .reaction-result {
        min-height: 120px;
        padding: 15px;
        border-radius: 10px;
        background-color: #fff;
        margin: 15px 0;
        border: 2px solid var(--primary);
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 90%;
      }

      .reaction-safe {
        background-color: #a5d6a7;
        color: var(--success);
      }

      .reaction-danger {
        background-color: #ffab91;
        color: var(--danger);
      }

      .reaction-explosion {
        background-color: #ffcc80;
        color: #e65100;
        animation: pulse 0.5s infinite;
      }

      .reaction-fizz {
        background-color: #bbdefb;
        color: #1565c0;
      }

      .chemical-warning {
        font-weight: bold;
        color: var(--danger);
        margin: 10px 0;
        text-align: center;
        max-width: 500px;
      }

      .chemical-instructions {
        text-align: center;
        margin-bottom: 10px;
        font-weight: bold;
        font-size: clamp(1rem, 3vw, 1.2rem);
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .reaction-icon {
        font-size: 36px;
        margin-bottom: 10px;
      }

      #megaMathButton {
        background-color: #fff8bd;
        color: rgb(0, 0, 0);
        border-radius: 5px;
        padding: 10px 15px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin: 10px;
        padding: 12px 25px;
        border: none;
        cursor: pointer;
        transition: transform 0.2s ease;
        width: 90%;
        max-width: 300px;
        font-weight: bold;
      }

      #megaMathButton:hover {
        background-color: #d1cb99;
      }

      /* NEW STYLES FOR SAFETY RULES WITH IMAGES */
      .safety-rule {
        display: flex;
        align-items: center;
        margin: 15px 0;
        padding: 10px;
        background-color: #fff;
        border-radius: 10px;
        border: 2px solid var(--accent);
      }

      .rule-icon {
        font-size: 32px;
        margin-right: 15px;
        min-width: 50px;
        text-align: center;
      }

      .rule-text {
        text-align: left;
        flex: 1;
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
      }

      .rules-container {
        max-height: 60vh;
        overflow-y: auto;
        padding: 10px;
      }

      /* Responsive adjustments */
      @media (max-width: 480px) {
        .safety-rule {
          flex-direction: column;
          text-align: center;
        }

        .rule-icon {
          margin-right: 0;
          margin-bottom: 10px;
        }

        .rule-text {
          text-align: center;
        }

        .equipment-item {
          flex-direction: column;
          text-align: center;
        }

        .equipment-icon {
          margin-right: 0;
          margin-bottom: 10px;
        }
      }

      @media (max-width: 768px) {
        .card {
          height: auto;
          min-height: auto;
          padding: 15px;
        }

        .scenario-image {
          height: 150px;
        }
      }

      /* Footer for very small screens */
      .footer-space {
        height: 20px;
        width: 100%;
      }

      /* Focus styles for accessibility */
      button:focus-visible,
      .equipment-item:focus-visible,
      .chemical-item:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    <div id="loadingScreen">
      <img
        id="loadingRocket"
        src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 10 L70 50 L50 70 L30 50 Z' fill='%23FF6600'/%3E%3Ccircle cx='50' cy='30' r='5' fill='%235170FF'/%3E%3C/svg%3E"
        alt="Rocket Loading Animation"
      />
      <div class="loading-text">Preparing Lab...</div>
    </div>

    <h1>Science Safety Adventure</h1>

    <div class="menu-container">
      <button onclick="showScreen('quizScreen')">
        <i class="fas fa-question-circle"></i> Safety Quiz
      </button>
      <button onclick="showScreen('equipmentScreen')">
        <i class="fas fa-microscope"></i> Lab Equipment
      </button>
      <button onclick="showScreen('scenarioScreen')">
        <i class="fas fa-flask"></i> Safety Scenarios
      </button>
      <button onclick="showScreen('rulesScreen')">
        <i class="fas fa-clipboard-list"></i> Safety Rules
      </button>
      <button onclick="showScreen('emergencyScreen')">
        <i class="fas fa-first-aid"></i> Emergency Procedures
      </button>
      <button onclick="showScreen('whsScreen')">
        <i class="fas fa-exclamation-triangle"></i> Hazard Symbols
      </button>
      <button onclick="showScreen('chemicalScreen')">
        <i class="fas fa-vial"></i> Chemical Mixing
      </button>
    </div>

    <div id="quizScreen" class="screen fade-in">
      <div class="card">
        <button class="close-btn" aria-label="Close">&times;</button>

        <h2>Science Safety Quiz</h2>
        <div id="quizQ"></div>
        <div id="quizOptions"></div>
        <div id="quizFeedback" class="feedback"></div>
        <button id="quizNextBtn" onclick="nextQuizQuestion()" disabled>
          Next Question
        </button>
      </div>
    </div>

    <div id="equipmentScreen" class="screen fade-in">
      <div class="card">
        <button class="close-btn" aria-label="Close">&times;</button>
        <h2>Lab Equipment</h2>
        <div id="equipmentList"></div>
      </div>
    </div>

    <div id="scenarioScreen" class="screen fade-in">
      <div class="card">
        <button class="close-btn" aria-label="Close">&times;</button>
        <h2>Safety Scenarios</h2>
        <div id="scenarioText"></div>
        <div class="scenario-image" id="scenarioImage">Scenario Image</div>
        <div id="scenarioOptions"></div>
        <div id="scenarioFeedback" class="feedback"></div>
        <button id="scenarioNextBtn" onclick="nextScenario()" disabled>
          Next Scenario
        </button>
      </div>
    </div>

    <div id="rulesScreen" class="screen fade-in">
      <div class="card">
        <button class="close-btn" aria-label="Close">&times;</button>
        <h2>Science Safety Rules</h2>
        <div class="rules-container" id="rulesList">
          <!-- Rules will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <div id="emergencyScreen" class="screen fade-in">
      <div class="card">
        <button class="close-btn" aria-label="Close">&times;</button>
        <h2>Emergency Procedures</h2>
        <div id="emergencyQuestion"></div>
        <div id="emergencyOptions"></div>
        <div id="emergencyFeedback" class="feedback"></div>
        <button id="emergencyNextBtn" onclick="nextEmergency()" disabled>
          Next Situation
        </button>
      </div>
    </div>

    <div id="whsScreen" class="screen fade-in">
      <div class="card">
        <button class="close-btn" aria-label="Close">&times;</button>
        <h2>Hazard Symbols</h2>
        <div id="symbolImage" class="scenario-image">Hazard Symbol</div>
        <div id="symbolOptions"></div>
        <div id="symbolFeedback" class="feedback"></div>
        <button id="symbolNextBtn" onclick="nextSymbol()" disabled>
          Next Symbol
        </button>
      </div>
    </div>

    <!-- Chemical Mixing Game -->
    <div id="chemicalScreen" class="screen fade-in">
      <div class="card">
        <button class="close-btn" aria-label="Close">&times;</button>

        <h2>Chemical Mixing Safety</h2>
        <div class="chemical-game">
          <p class="chemical-instructions">Select two chemicals to mix!</p>

          <div class="chemicals-container">
            <div
              class="chemical-item"
              style="background-color: #ff9999"
              onclick="selectChemical('acid')"
              tabindex="0"
              role="button"
              aria-label="Acid chemical"
            >
              <div>🧪</div>
              <div>Acid</div>
            </div>
            <div
              class="chemical-item"
              style="background-color: #9999ff"
              onclick="selectChemical('base')"
              tabindex="0"
              role="button"
              aria-label="Base chemical"
            >
              <div>🧪</div>
              <div>Base</div>
            </div>
            <div
              class="chemical-item"
              style="background-color: #ffff99"
              onclick="selectChemical('oxidizer')"
              tabindex="0"
              role="button"
              aria-label="Oxidizer chemical"
            >
              <div>🧪</div>
              <div>Oxidizer</div>
            </div>
            <div
              class="chemical-item"
              style="background-color: #99ff99"
              onclick="selectChemical('water')"
              tabindex="0"
              role="button"
              aria-label="Water chemical"
            >
              <div>💧</div>
              <div>Water</div>
            </div>
            <div
              class="chemical-item"
              style="background-color: #ffcc99"
              onclick="selectChemical('organic')"
              tabindex="0"
              role="button"
              aria-label="Organic Solvent chemical"
            >
              <div>🪔</div>
              <div>Organic Solvent</div>
            </div>
            <div
              class="chemical-item"
              style="background-color: #ff99cc"
              onclick="selectChemical('metal')"
              tabindex="0"
              role="button"
              aria-label="Reactive Metal chemical"
            >
              <div>⚙️</div>
              <div>Reactive Metal</div>
            </div>
            <div
              class="chemical-item"
              style="background-color: #cc99ff"
              onclick="selectChemical('cyanide')"
              tabindex="0"
              role="button"
              aria-label="Cyanide chemical"
            >
              <div>☠️</div>
              <div>Cyanide</div>
            </div>
            <div
              class="chemical-item"
              style="background-color: #99ccff"
              onclick="selectChemical('sulfide')"
              tabindex="0"
              role="button"
              aria-label="Sulfide chemical"
            >
              <div>🪨</div>
              <div>Sulfide</div>
            </div>
          </div>

          <div class="mixing-area" id="mixingArea">
            Drag chemicals here or click to select
          </div>

          <div class="reaction-result" id="reactionResult">
            <div class="reaction-icon">⚗️</div>
            <div>Reaction result will appear here</div>
          </div>
          <button onclick="resetMixing()">Reset Experiment</button>
        </div>
      </div>
    </div>

    <div class="footer-space"></div>

    <!-- 🔊 Sound Effects -->
    <audio id="correctSound" src="correct-6033 - Copy.mp3"></audio>
    <audio id="wrongSound" src="wrong-47985 - Copy.mp3"></audio>
    <audio id="explosionSound" src="explosion-40585.mp3"></audio>
    <audio id="fizzSound" src="fizz-91102.mp3"></audio>
    <audio id="bubbleSound" src="bubble-142194.mp3"></audio>

    <script>
      // 🔹 Hide loading screen after page fully loads
      window.addEventListener("load", () => {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) {
          loadingScreen.style.opacity = "0";
          setTimeout(() => {
            loadingScreen.style.display = "none";
          }, 600); // matches fade duration
        }
      });

      // Global variables to track if an answer has been selected
      let quizAnswered = false;
      let scenarioAnswered = false;
      let emergencyAnswered = false;
      let symbolAnswered = false;

      // Chemical mixing game variables
      let selectedChemicals = [];
      const chemicalReactions = {
        "acid-base": {
          result:
            "Neutralization reaction! Salt and water are formed. This is generally safe when done carefully.",
          safe: true,
          effect: "fizz",
          icon: "🧂",
        },
        "acid-oxidizer": {
          result:
            "Dangerous reaction! Could produce toxic chlorine gas or other hazardous products.",
          safe: false,
          effect: "danger",
          icon: "☠️",
        },
        "acid-water": {
          result:
            "Always add acid to water, not water to acid! This is safe if done correctly to prevent splashing.",
          safe: true,
          effect: "safe",
          icon: "⚠️",
        },
        "base-oxidizer": {
          result:
            "Potentially dangerous reaction! Could produce heat and cause splattering of corrosive materials.",
          safe: false,
          effect: "danger",
          icon: "🔥",
        },
        "base-water": {
          result:
            "Dissolution reaction. Some bases dissolve exothermically in water - add slowly with stirring.",
          safe: true,
          effect: "safe",
          icon: "🌡️",
        },
        "oxidizer-water": {
          result:
            "Generally safe, but some strong oxidizers react violently with water! Check compatibility first.",
          safe: false,
          effect: "danger",
          icon: "💥",
        },
        "acid-organic": {
          result:
            "Potential fire hazard! Some organic solvents can react dangerously with strong acids.",
          safe: false,
          effect: "danger",
          icon: "🔥",
        },
        "base-organic": {
          result:
            "Reaction possible! Some organic compounds can saponify or react with strong bases.",
          safe: false,
          effect: "danger",
          icon: "⚠️",
        },
        "oxidizer-organic": {
          result:
            "EXTREME FIRE HAZARD! Many organic materials combust violently with strong oxidizers.",
          safe: false,
          effect: "explosion",
          icon: "💥",
        },
        "water-organic": {
          result:
            "Generally immiscible. Some organics may react with water over time (hydrolysis).",
          safe: true,
          effect: "safe",
          icon: "🔍",
        },
        "acid-metal": {
          result:
            "Produces hydrogen gas! Highly flammable - keep away from ignition sources.",
          safe: false,
          effect: "fizz",
          icon: "💨",
        },
        "base-metal": {
          result:
            "Some metals react with bases to produce hydrogen gas. Handle with caution.",
          safe: false,
          effect: "fizz",
          icon: "💨",
        },
        "water-metal": {
          result:
            "Reactive metals like sodium explode on contact with water! EXTREME DANGER.",
          safe: false,
          effect: "explosion",
          icon: "💥",
        },
        "acid-cyanide": {
          result:
            "PRODUCES DEADLY HYDROGEN CYANIDE GAS! Never mix acids with cyanide compounds.",
          safe: false,
          effect: "danger",
          icon: "☠️",
        },
        "sulfide-acid": {
          result:
            "Produces toxic hydrogen sulfide gas! Smells like rotten eggs and is highly dangerous.",
          safe: false,
          effect: "danger",
          icon: "☠️",
        },
        "cyanide-oxidizer": {
          result:
            "Can produce highly toxic cyanogen gas. Avoid mixing these compounds.",
          safe: false,
          effect: "danger",
          icon: "⚠️",
        },
        same: {
          result:
            "Mixing the same chemicals just gives you more of the same. No reaction occurs.",
          safe: true,
          effect: "safe",
          icon: "➡️",
        },
        default: {
          result:
            "No significant reaction occurs between these chemicals under normal conditions.",
          safe: true,
          effect: "safe",
          icon: "✅",
        },
      };

      function showScreen(id) {
        document
          .querySelectorAll(".screen")
          .forEach((s) => s.classList.remove("active"));
        document.getElementById(id).classList.add("active");

        // Reset answer tracking when switching screens
        quizAnswered = false;
        scenarioAnswered = false;
        emergencyAnswered = false;
        symbolAnswered = false;

        // Update next button states
        document.getElementById("quizNextBtn").disabled = true;
        document.getElementById("scenarioNextBtn").disabled = true;
        document.getElementById("emergencyNextBtn").disabled = true;
        document.getElementById("symbolNextBtn").disabled = true;

        // Initialize the screen if needed
        if (id === "quizScreen") showQuizQuestion();
        else if (id === "equipmentScreen") showEquipment();
        else if (id === "scenarioScreen") showScenario();
        else if (id === "rulesScreen") showRules();
        else if (id === "emergencyScreen") showEmergency();
        else if (id === "matchingScreen") showMatching();
        else if (id === "whsScreen") showSymbol();
        else if (id === "chemicalScreen") resetMixing();

        // Scroll to top when changing screens
        window.scrollTo(0, 0);
      }

      // Science Safety Quiz
      const quizQuestions = [
        {
          question: "What should you wear to protect your eyes in the lab?",
          options: [
            "😎 Sunglasses",
            "🥽 Safety goggles",
            "👓 Regular glasses",
            "🚫 Nothing",
          ],
          answer: 1,
        },
        {
          question: "What should you do if you break glassware?",
          options: [
            "🚫 Hide it",
            "🗣️ Tell the teacher immediately",
            "🧤 Sweep it with your hands",
            "🚫 Ignore it",
          ],
          answer: 1,
        },
        {
          question: "When should you wear gloves in the lab?",
          options: [
            "🔥 Only when handling hot materials",
            "🧑‍🔬 Only when handling chemicals",
            "🧑‍🔬 Whenever handling materials",
            "🚫 Never",
          ],
          answer: 2,
        },
        {
          question: "What should you do with long hair during experiments?",
          options: [
            "👩‍🦰 Leave it down",
            "🪢 Tie it back",
            "👒 Wear a hat",
            "✂️ Cut it short",
          ],
          answer: 1,
        },
        {
          question: "How should you smell a chemical?",
          options: [
            "👃 Directly from the container",
            "👃 By wafting the fumes toward you",
            "👃 With your face close to the container",
            "🚫 You should never smell chemicals",
          ],
          answer: 1,
        },
      ];

      let quizIndex = 0;

      function showQuizQuestion() {
        const question = quizQuestions[quizIndex];
        document.getElementById("quizQ").textContent = question.question;

        let optionsHTML = "";
        question.options.forEach((option, index) => {
          optionsHTML += `<div class="equipment-item" onclick="checkQuizAnswer(${index})" tabindex="0" role="button">
            <div class="equipment-icon">${index + 1}</div>
            <div>${option}</div>
          </div>`;
        });

        document.getElementById("quizOptions").innerHTML = optionsHTML;
        document.getElementById("quizFeedback").textContent = "";
        document.getElementById("quizFeedback").className = "feedback";

        // Reset answer tracking
        quizAnswered = false;
        document.getElementById("quizNextBtn").disabled = true;
      }

      function checkQuizAnswer(selectedIndex) {
        const correctIndex = quizQuestions[quizIndex].answer;
        const correctSound = document.getElementById("correctSound");
        const wrongSound = document.getElementById("wrongSound");

        if (selectedIndex === correctIndex) {
          document.getElementById("quizFeedback").textContent =
            "✅ Correct! Good job!";
          document.getElementById("quizFeedback").className =
            "feedback correct";
          correctSound.play();
        } else {
          document.getElementById("quizFeedback").textContent =
            "❌ Incorrect. The right answer is: " +
            quizQuestions[quizIndex].options[correctIndex];
          document.getElementById("quizFeedback").className =
            "feedback incorrect";
          wrongSound.play();
        }

        // Enable the next button
        quizAnswered = true;
        document.getElementById("quizNextBtn").disabled = false;
      }

      function nextQuizQuestion() {
        quizIndex = (quizIndex + 1) % quizQuestions.length;
        showQuizQuestion();
      }

      // Lab Equipment
      const equipment = [
        { name: "Safety Goggles", icon: "👓", purpose: "Eye protection" },
        { name: "Lab Coat", icon: "🥼", purpose: "Protect skin and clothing" },
        { name: "Gloves", icon: "🧤", purpose: "Hand protection" },
        { name: "Beaker", icon: "🧪", purpose: "Mixing and heating liquids" },
        {
          name: "Test Tube",
          icon: "⚗️",
          purpose: "distill, or separate and purify, substances",
        },
        { name: "Bunsen Burner", icon: "🔥", purpose: "Heating substances" },
        { name: "Microscope", icon: "🔬", purpose: "Viewing small objects" },
        {
          name: "Safety Shower",
          icon: "🚿",
          purpose: "Emergency chemical rinse",
        },
        { name: "Fire Extinguifier", icon: "🧯", purpose: "Put out fires" },
      ];

      function showEquipment() {
        let equipmentHTML = "";
        equipment.forEach((item) => {
          equipmentHTML += `<div class="equipment-item">
            <div class="equipment-icon">${item.icon}</div>
            <div><strong>${item.name}</strong>: ${item.purpose}</div>
          </div>`;
        });

        document.getElementById("equipmentList").innerHTML = equipmentHTML;
      }

      // Safety Scenarios
      const scenarios = [
        {
          scenario:
            "You accidentally spill a small amount of chemical on your hand. What should you do?",
          options: [
            "Wipe it on your lab coat",
            "Rinse with water for 15 minutes",
            "Ignore it",
            "Ask a friend for help",
          ],
          answer: 1,
          imageText: "Chemical Spill",
        },
        {
          scenario:
            "A beaker of water is boiling on a hot plate and starts to bubble over. What should you do?",
          options: [
            "Turn off the hot plate",
            "Move the beaker with your hands",
            "Add cold water to cool it",
            "Yell for help",
          ],
          answer: 0,
          imageText: "Boiling Over",
        },
        {
          scenario:
            "You notice a small fire in a trash can. What should you do first?",
          options: [
            "Throw water on it",
            "Use a fire extinguisher",
            "Tell the teacher immediately",
            "Evacuate the room",
          ],
          answer: 2,
          imageText: "Fire Emergency",
        },
      ];

      let scenarioIndex = 0;

      function showScenario() {
        const scenario = scenarios[scenarioIndex];
        document.getElementById("scenarioText").textContent = scenario.scenario;
        document.getElementById("scenarioImage").textContent =
          scenario.imageText;

        let optionsHTML = "";
        scenario.options.forEach((option, index) => {
          optionsHTML += `<div class="equipment-item" onclick="checkScenarioAnswer(${index})" tabindex="0" role="button">
            <div class="equipment-icon">${index + 1}</div>
            <div>${option}</div>
          </div>`;
        });

        document.getElementById("scenarioOptions").innerHTML = optionsHTML;
        document.getElementById("scenarioFeedback").textContent = "";
        document.getElementById("scenarioFeedback").className = "feedback";

        // Reset answer tracking
        scenarioAnswered = false;
        document.getElementById("scenarioNextBtn").disabled = true;
      }

      function checkScenarioAnswer(selectedIndex) {
        const correctIndex = scenarios[scenarioIndex].answer;
        const correctSound = document.getElementById("correctSound");
        const wrongSound = document.getElementById("wrongSound");

        if (selectedIndex === correctIndex) {
          document.getElementById("scenarioFeedback").textContent =
            "✅ Correct! That's the safe choice.";
          document.getElementById("scenarioFeedback").className =
            "feedback correct";
          correctSound.play();
        } else {
          document.getElementById("scenarioFeedback").textContent =
            "❌ Incorrect. The right answer is: " +
            scenarios[scenarioIndex].options[correctIndex];
          document.getElementById("scenarioFeedback").className =
            "feedback incorrect";
          wrongSound.play();
        }

        // Enable the next button
        scenarioAnswered = true;
        document.getElementById("scenarioNextBtn").disabled = false;
      }

      function nextScenario() {
        scenarioIndex = (scenarioIndex + 1) % scenarios.length;
        showScenario();
      }

      // Safety Rules with Images
      const safetyRules = [
        { rule: "Always wear safety goggles", icon: "🥽", color: "#5170ff" },
        { rule: "Tie back long hair", icon: "👩‍🦰", color: "#ff6600" },
        { rule: "No eating or drinking in lab", icon: "🚫", color: "#c62828" },
        { rule: "Know emergency procedures", icon: "📋", color: "#2e7d32" },
        { rule: "Report accidents immediately", icon: "⚠️", color: "#ff9900" },
        { rule: "Wear appropriate clothing", icon: "👕", color: "#9c27b0" },
        { rule: "Never work alone", icon: "👥", color: "#1565c0" },
        { rule: "Label all containers", icon: "🏷️", color: "#00796b" },
        { rule: "Dispose of waste properly", icon: "🗑️", color: "#795548" },
      ];

      function showRules() {
        let rulesHTML = "";
        safetyRules.forEach((ruleObj, index) => {
          rulesHTML += `
            <div class="safety-rule">
              <div class="rule-icon" style="color: ${ruleObj.color}">${
            ruleObj.icon
          }</div>
              <div class="rule-text">${index + 1}. ${ruleObj.rule}</div>
            </div>
          `;
        });

        document.getElementById("rulesList").innerHTML = rulesHTML;
      }

      // Emergency Procedures
      const emergencies = [
        {
          question: "What should you do if chemicals get in your eyes?",
          options: [
            "🤦 Rub your eyes",
            "💦 Use the eyewash station",
            "👀 Blink repeatedly",
            "⏳ Wait to see if it stings",
          ],
          answer: 1,
        },
        {
          question: "If your clothing catches fire, what should you do?",
          options: [
            "🏃‍♂️ Run for help",
            "🔥 Stop, drop, and roll",
            "👕 Take off your clothes",
            "💦 Pour water on yourself",
          ],
          answer: 1,
        },
        {
          question: "What should you do if you cut yourself with glass?",
          options: [
            "👩🏻‍💻 Continue working",
            "🗣️ Tell the teacher and get first aid",
            "🕵️‍♀️ Hide the evidence",
            "🩹 Use tape as a bandage",
          ],
          answer: 1,
        },
      ];

      let emergencyIndex = 0;

      function showEmergency() {
        const emergency = emergencies[emergencyIndex];
        document.getElementById("emergencyQuestion").textContent =
          emergency.question;

        let optionsHTML = "";
        emergency.options.forEach((option, index) => {
          optionsHTML += `<div class="equipment-item" onclick="checkEmergencyAnswer(${index})" tabindex="0" role="button">
            <div class="equipment-icon">${index + 1}</div>
            <div>${option}</div>
          </div>`;
        });

        document.getElementById("emergencyOptions").innerHTML = optionsHTML;
        document.getElementById("emergencyFeedback").textContent = "";
        document.getElementById("emergencyFeedback").className = "feedback";

        // Reset answer tracking
        emergencyAnswered = false;
        document.getElementById("emergencyNextBtn").disabled = true;
      }

      function checkEmergencyAnswer(selectedIndex) {
        const correctIndex = emergencies[emergencyIndex].answer;
        const correctSound = document.getElementById("correctSound");
        const wrongSound = document.getElementById("wrongSound");

        if (selectedIndex === correctIndex) {
          document.getElementById("emergencyFeedback").textContent =
            "✅ Correct! This is the right emergency procedure.";
          document.getElementById("emergencyFeedback").className =
            "feedback correct";
          correctSound.play();
        } else {
          document.getElementById("emergencyFeedback").textContent =
            "❌ Incorrect. The right answer is: " +
            emergencies[emergencyIndex].options[correctIndex];
          document.getElementById("emergencyFeedback").className =
            "feedback incorrect";
          wrongSound.play();
        }

        // Enable the next button
        emergencyAnswered = true;
        document.getElementById("emergencyNextBtn").disabled = false;
      }

      function nextEmergency() {
        emergencyIndex = (emergencyIndex + 1) % emergencies.length;
        showEmergency();
      }

      // Safety Matching
      const matchingQuestions = [
        {
          question: "Match the symbol to its meaning:",
          options: ["Flammable", "Corrosive", "Toxic", "Explosive"],
          answers: ["🔥 Flammable", "💧 Corrosive", "☠️ Toxic", "💥 Explosive"],
        },
        {
          question: "Match the equipment to its use:",
          options: [
            "For eye protection",
            "For hand protection",
            "For emergency rinsing",
            "For putting out fires",
          ],
          answers: [
            "👓 Safety goggles",
            "🧤 Gloves",
            "🚿 Safety shower",
            "🧯 Fire extinguisher",
          ],
        },
      ];

      let matchingIndex = 0;

      function showMatching() {
        const matching = matchingQuestions[matchingIndex];
        document.getElementById("matchingQuestion").textContent =
          matching.question;

        let optionsHTML = "";
        matching.answers.forEach((answer, index) => {
          optionsHTML += `<div class="equipment-item">
            <div class="equipment-icon">${index + 1}</div>
            <div>${answer}</div>
          </div>`;
        });

        document.getElementById("matchingOptions").innerHTML = optionsHTML;
        document.getElementById("matchingFeedback").textContent =
          "Match the items correctly!";
        document.getElementById("matchingFeedback").className = "feedback";

        // For matching, we'll enable the next button immediately since it's informational
        document.getElementById("matchingNextBtn").disabled = false;
      }

      function nextMatching() {
        matchingIndex = (matchingIndex + 1) % matchingQuestions.length;
        showMatching();
      }

      // Hazard Symbols
      const whsSymbols = [
        {
          symbol: "Flammable",
          options: [
            "Catches fire easily",
            "Poisonous if ingested",
            "Causes skin burns",
            "May explode if heated",
          ],
          answer: 0,
          imageText: "🔥 Flammable",
        },
        {
          symbol: "Corrosive",
          options: [
            "Causes skin burns",
            "Catches fire easily",
            "Harmful to environment",
            "May explode if heated",
          ],
          answer: 0,
          imageText: "💧 Corrosive",
        },
        {
          symbol: "Toxic",
          options: [
            "Poisonous if ingested",
            "Causes skin irritation",
            "Radioactive",
            "Harmful to environment",
          ],
          answer: 0,
          imageText: "☠️ Toxic",
        },
      ];

      let symbolIndex = 0;

      function showSymbol() {
        const symbol = whsSymbols[symbolIndex];
        document.getElementById("symbolImage").textContent = symbol.imageText;

        let optionsHTML = "";
        symbol.options.forEach((option, index) => {
          optionsHTML += `<div class="equipment-item" onclick="checkSymbolAnswer(${index})" tabindex="0" role="button">
            <div class="equipment-icon">${index + 1}</div>
            <div>${option}</div>
          </div>`;
        });

        document.getElementById("symbolOptions").innerHTML = optionsHTML;
        document.getElementById("symbolFeedback").textContent = "";
        document.getElementById("symbolFeedback").className = "feedback";

        // Reset answer tracking
        symbolAnswered = false;
        document.getElementById("symbolNextBtn").disabled = true;
      }

      function checkSymbolAnswer(selectedIndex) {
        const correctIndex = whsSymbols[symbolIndex].answer;
        const correctSound = document.getElementById("correctSound");
        const wrongSound = document.getElementById("wrongSound");

        if (selectedIndex === correctIndex) {
          document.getElementById("symbolFeedback").textContent =
            "✅ Correct! You know your hazard symbols.";
          document.getElementById("symbolFeedback").className =
            "feedback correct";
          correctSound.play();
        } else {
          document.getElementById("symbolFeedback").textContent =
            "❌ Incorrect. This symbol means: " +
            whsSymbols[symbolIndex].options[correctIndex];
          document.getElementById("symbolFeedback").className =
            "feedback incorrect";
          wrongSound.play();
        }

        // Enable the next button
        symbolAnswered = true;
        document.getElementById("symbolNextBtn").disabled = false;
      }

      function nextSymbol() {
        symbolIndex = (symbolIndex + 1) % whsSymbols.length;
        showSymbol();
      }

      // Chemical Mixing Game Functions
      function selectChemical(chemical) {
        if (selectedChemicals.length < 2) {
          selectedChemicals.push(chemical);
          updateChemicalSelection();
          updateMixingArea();

          if (selectedChemicals.length === 2) {
            mixChemicals();
          }
        }
      }

      function updateChemicalSelection() {
        // Remove any existing selection highlights
        document.querySelectorAll(".chemical-item").forEach((item) => {
          item.classList.remove("selected");
        });

        // Highlight selected chemicals if any
        if (selectedChemicals.length > 0) {
          selectedChemicals.forEach((chem) => {
            const chemicalElement = document.querySelector(
              `.chemical-item[onclick="selectChemical('${chem}')"]`
            );
            if (chemicalElement) {
              chemicalElement.classList.add("selected");
            }
          });
        }
      }

      function updateMixingArea() {
        const mixingArea = document.getElementById("mixingArea");
        if (selectedChemicals.length === 0) {
          mixingArea.innerHTML = "Drag chemicals here or click to select";
        } else {
          mixingArea.innerHTML = selectedChemicals
            .map((chem) => {
              switch (chem) {
                case "acid":
                  return "🧪 Acid";
                case "base":
                  return "🧪 Base";
                case "oxidizer":
                  return "🧪 Oxidizer";
                case "water":
                  return "💧 Water";
                case "organic":
                  return "🪔 Organic Solvent";
                case "metal":
                  return "⚙️ Reactive Metal";
                case "cyanide":
                  return "☠️ Cyanide";
                case "sulfide":
                  return "🪨 Sulfide";
                default:
                  return chem;
              }
            })
            .join(" + ");
        }
      }

      function mixChemicals() {
        const reactionResult = document.getElementById("reactionResult");
        const [chem1, chem2] = selectedChemicals;
        let reactionKey = "default";

        // Check if mixing the same chemicals
        if (chem1 === chem2) {
          reactionKey = "same";
        } else {
          // Create a consistent key regardless of order
          const sortedChems = [chem1, chem2].sort().join("-");
          reactionKey =
            sortedChems in chemicalReactions ? sortedChems : "default";
        }

        const reaction = chemicalReactions[reactionKey];

        // Play appropriate sound
        if (reaction.effect === "danger") {
          document.getElementById("wrongSound").play();
        } else if (reaction.effect === "fizz") {
          document.getElementById("fizzSound").play();
        } else if (reaction.effect === "explosion") {
          document.getElementById("explosionSound").play();
        } else {
          document.getElementById("correctSound").play();
        }

        // Display result with appropriate styling
        reactionResult.innerHTML = `
          <div class="reaction-icon">${reaction.icon}</div>
          <div>${reaction.result}</div>
        `;
        reactionResult.className = "reaction-result";

        if (reaction.safe) {
          reactionResult.classList.add("reaction-safe");
        } else {
          reactionResult.classList.add("reaction-danger");
        }

        // Special case for particularly dangerous reactions
        if (reaction.effect === "explosion") {
          reactionResult.classList.add("reaction-explosion");
        } else if (reaction.effect === "fizz") {
          reactionResult.classList.add("reaction-fizz");
        }
      }

      function resetMixing() {
        selectedChemicals = [];
        updateChemicalSelection();
        updateMixingArea();
        document.getElementById("reactionResult").innerHTML = `
          <div class="reaction-icon">⚗️</div>
          <div>Reaction result will appear here</div>
        `;
        document.getElementById("reactionResult").className = "reaction-result";
      }

      // Initialize the game
      window.onload = function () {
        setTimeout(() => {
          document.getElementById("loadingScreen").style.display = "none";
          showEquipment();
          showRules();
        }, 1500);
      };

      // Add keyboard navigation support
      document.addEventListener("keydown", function (e) {
        if (e.key === "Enter" || e.key === " ") {
          const focused = document.activeElement;
          if (
            focused.classList.contains("equipment-item") ||
            focused.classList.contains("chemical-item")
          ) {
            focused.click();
          }
        }
      });

      // Make all close buttons functional
      document.querySelectorAll(".close-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const screen = btn.closest(".screen"); // find parent screen
          if (screen) {
            screen.classList.remove("active"); // hide screen
          }
        });
      });

      // Close button logic
      document.querySelectorAll(".close-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const screen = btn.closest(".screen");
          if (screen) {
            screen.classList.remove("active");
          }
        });
      });

      // Overlay click logic
      document.querySelectorAll(".screen").forEach((screen) => {
        screen.addEventListener("click", (event) => {
          // Only close if the click is on the overlay (not inside the card)
          if (event.target === screen) {
            screen.classList.remove("active");
          }
        });
      });
    </script>
  </body>
</html>
